<!DOCTYPE html>
<html lang="sv">
<head>
<meta charset="UTF-8">
<title>Prioriteringsregler â€“ MatteÃ¶vning</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- MathJax fÃ¶r snygg brÃ¥knotation -->
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" defer body { font-family: Arial; max-width: 650px; margin: auto; padding: 20px; }
  h1 { margin-bottom: 10px; }
  #task { font-size: 30px; margin: 20px 0; min-height: 40px; }
  .levels button { padding: 6px 12px; margin: 4px; font-size: 16px; }
  #answer { font-size: 18px; padding: 6px; width: 120px; }
  #feedback { font-size: 18px; font-weight: bold; margin-top: 10px; }
</style>
</head>
<body>

<h1>TrÃ¤na pÃ¥ prioriteringsregler</h1>

<div class="levels">
  <button onclick="setLevel('blue')">ğŸ”µ BlÃ¥</button>
  <button onclick="setLevel('green')">ğŸŸ¢ GrÃ¶n</button>
  <button onclick="setLevel('yellow')">ğŸŸ¡ Gul</button>
  <button onclick="setLevel('red')">ğŸ”´ RÃ¶d</button>
</div>

<div id="task">â€”</div>

<input id="answer" placeholder="Skriv ditt svar">
<button onclick="checkAnswer()">Kontrollera</button>
<button onclick="newTask()">Ny uppgift</button>

<p id="feedback"></p>

<script>
// =========================================================
// Globala variabler
// =========================================================

let currentLevel = "blue";
let correctAnswer = 0;

// Slumptal
function r(min, max) { return Math.floor(Math.random() * (max - min + 1)) + min; }

// =========================================================
// 1. Generering av uttryck per nivÃ¥ (nya rena versionen)
// =========================================================

// ğŸ”µ BlÃ¥ (multiplikation med Â· , inga parenteser)
function genBlue() {
    let a = r(1, 15);
    let b = r(1, 12);
    let c = r(1, 12);
    return `${a} + ${b} Â· ${c}`;
}

// ğŸŸ¢ GrÃ¶n (en nÃ¶dvÃ¤ndig parentes)
function genGreen() {
    let a = r(2, 12);
    let b = r(2, 12);
    let c = r(1, b - 1); // garanterar positivt resultat

    let op = Math.random() < 0.5 ? "+" : "-";
    return `${a} Â· (${b} ${op} ${c})`;
}

// ğŸŸ¡ Gul (tvÃ¥ parentesgrupper, rena uttryck)
function genYellow() {
    let a = r(2, 12), b = r(2, 12);
    let c = r(2, 12), d = r(1, c - 1);
    return `(${a} + ${b}) Â· (${c} - ${d})`;
}

// ğŸ”´ RÃ¶d (ALLTID en division som brÃ¥k)
function genRed() {

    let a = r(2, 12);
    let b = r(2, 12);

    // Division ska ALLTID synas, som brÃ¥k
    let divisor = r(2, 12);
    let numerator = divisor * r(1, 12);

    // MathJax-brÃ¥k
    let frac = `\\frac{${numerator}}{${divisor}}`;

    // Exempel: 5 + 7 Â· \frac{20}{4}
    return `${a} + ${b} Â· ${frac}`;
}

// =========================================================
// 2. Huvudgenerator
// =========================================================

function generateExpression(level) {
    if (level === "blue") return genBlue();
    if (level === "green") return genGreen();
    if (level === "yellow") return genYellow();
    if (level === "red") return genRed();
}

// =========================================================
// 3. UtvÃ¤rdering av MathJax-uttryck
// =========================================================

function evaluateMathJax(expr) {
    // ersÃ¤tt alla \frac{a}{b} â†’ (a/b)
    let jsExpr = expr
        .replace(/\\frac{(\d+)}{(\d+)}/g, "($1/$2)")
        .replace(/Â·/g, "*");   // bullet operator till JS-multiplikation

    return Function('"use strict"; return (' + jsExpr + ')')();
}

// =========================================================
// 4. Rendera och skapa ny uppgift
// =========================================================

function newTask() {
    let expr = generateExpression(currentLevel);
    correctAnswer = evaluateMathJax(expr);

    document.getElementById("task").innerHTML = "\\(" + expr + "\\)";
    MathJax.typeset();

    document.getElementById("feedback").innerText = "";
    document.getElementById("answer").value = "";
}

// =========================================================
// 5. Kontrollera svaret
// =========================================================

function checkAnswer() {
    let ans = Number(document.getElementById("answer").value);
    if (ans === correctAnswer) {
        document.getElementById("feedback").innerText = "RÃ¤tt! ğŸ‰";
    } else {
        document.getElementById("feedback").innerText = "Fel â€“ fÃ¶rsÃ¶k igen!";
    }
}

// =========================================================
// 6. VÃ¤lj nivÃ¥
// =========================================================

function setLevel(level) {
    currentLevel = level;
    newTask();
}

// Startuppgift
newTask();

</script>

</body>
</html>