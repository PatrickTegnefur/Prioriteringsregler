<!DOCTYPE html>
<html lang="sv">
<head>
<meta charset="UTF-8">
<title>Prioriteringsregler â€“ MatteÃ¶vning</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- MathJax fÃ¶r brÃ¥k -->
https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js

<style>
  body { font-family: Arial; max-width: 650px; margin: auto; padding: 20px; }
  h1 { margin-bottom: 10px; }
  #task { font-size: 30px; margin: 20px 0; min-height: 40px; }
  .levels button { padding: 6px 12px; margin: 4px; font-size: 16px; }
  #answer { font-size: 18px; padding: 6px; width: 120px; }
  #feedback { font-size: 18px; font-weight: bold; margin-top: 10px; }
</style>
</head>
<body>

<h1>TrÃ¤na pÃ¥ prioriteringsregler</h1>

<div class="levels">
  <button onclick="setLevel('blue')">ðŸ”µ BlÃ¥</button>
  <button onclick="setLevel('green')">ðŸŸ¢ GrÃ¶n</button>
  <button onclick="setLevel('yellow')">ðŸŸ¡ Gul</button>
  <button onclick="setLevel('red')">ðŸ”´ RÃ¶d</button>
</div>

<div id="task">â€”</div>

<input id="answer" placeholder="Skriv ditt svar">
<button onclick="checkAnswer()">Kontrollera</button>
<button onclick="newTask()">Ny uppgift</button>

<p id="feedback"></p>

<script>
// =========================================================
// Globala variabler
// =========================================================

let currentLevel = "blue";
let correctAnswer = 0;

// Slumptal
function r(min, max) { return Math.floor(Math.random() * (max - min + 1)) + min; }

// =========================================================
// 1. Generering av uttryck per nivÃ¥
// =========================================================

// ðŸ”µ BlÃ¥ (endast + och * , inga parenteser, inga negativa tal)
function genBlue() {
    let a = r(1, 15);
    let b = r(1, 12);
    let c = r(1, 12);
    return `${a} + ${b} * ${c}`;
}

// ðŸŸ¢ GrÃ¶n (en parentes â€“ endast dÃ¤r den behÃ¶vs)
function genGreen() {
    let a = r(2, 12);
    let b = r(2, 12);
    let c = r(1, b - 1);  // garanterar positivt resultat

    let op = Math.random() < 0.5 ? "+" : "-";
    return `${a} * (${b} ${op} ${c})`;
}

// ðŸŸ¡ Gul (tvÃ¥ parentesdelar, men rena och begripliga)
function genYellow() {
    let a = r(2, 12), b = r(2, 12);
    let c = r(2, 12), d = r(1, c - 1);
    return `(${a} + ${b}) * (${c} - ${d})`;
}

// ðŸ”´ RÃ¶d (inkluderar brÃ¥k med MathJax, fortfarande heltalsdivision)
function genRed() {
    let a = r(2, 12);
    let b = r(2, 12);

    // skapa sÃ¤ker heltalsdivision
    let divisor = r(2, 12);
    let numerator = divisor * r(1, 12);

    let frac = `\\frac{${numerator}}{${divisor}}`;

    return `${a} + ${b} * ${frac}`;
}

// =========================================================
// 2. Huvudgenerator
// =========================================================

function generateExpression(level) {
    if (level === "blue") return genBlue();
    if (level === "green") return genGreen();
    if (level === "yellow") return genYellow();
    if (level === "red") return genRed();
}

// =========================================================
// 3. UtvÃ¤rdering av MathJax-uttryck
// =========================================================

function evaluateMathJax(expr) {
    // ersÃ¤tt alla \frac{a}{b} med (a/b)
    let jsExpr = expr.replace(/\\frac{(\d+)}{(\d+)}/g, "($1/$2)");
    return Function('"use strict"; return (' + jsExpr + ')')();
}

// =========================================================
// 4. Rendera och skapa ny uppgift
// =========================================================

function newTask() {
    let expr = generateExpression(currentLevel);
    correctAnswer = evaluateMathJax(expr);

    document.getElementById("task").innerHTML = "\\(" + expr + "\\)";
    MathJax.typeset();

    document.getElementById("feedback").innerText = "";
    document.getElementById("answer").value = "";
}

// =========================================================
// 5. Kontrollera svaret
// =========================================================

function checkAnswer() {
    let ans = Number(document.getElementById("answer").value);
    if (ans === correctAnswer) {
        document.getElementById("feedback").innerText = "RÃ¤tt! ðŸŽ‰";
    } else {
        document.getElementById("feedback").innerText = "Fel â€“ fÃ¶rsÃ¶k igen!";
    }
}

// =========================================================
// 6. VÃ¤lj nivÃ¥
// =========================================================

function setLevel(level) {
    currentLevel = level;
    newTask();
}

// Starta fÃ¶rsta uppgiften
newTask();

</script>

</body>
</html>