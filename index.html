<!DOCTYPE html>
<html lang="sv">
<head>
<meta charset="UTF-8">
<title>Prioriteringsregler â€“ MatteÃ¶vning</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://cdn.jsdelivrjax@3/es5/tex-mml-chtml.js</script>

<style>
  body { font-family: Arial, sans-serif; max-width: 650px; margin: auto; padding: 20px; }
  h1 { margin-bottom: 10px; }
  #task { font-size: 30px; margin: 20px 0; min-height: 40px; }
  .levels button { padding: 6px 12px; margin: 4px; font-size: 16px; }
  #answer { font-size: 18px; padding: 6px; width: 140px; }
  #feedback { font-size: 18px; font-weight: bold; margin-top: 10px; min-height: 28px; }
</style>
</head>
<body>

<h1>TrÃ¤na pÃ¥ prioriteringsregler</h1>

<div class="levels">
  <button onclick="setLevel('blue')">ðŸ”µ BlÃ¥</button>
  <button onclick="setLevel('green')">ðŸŸ¢ GrÃ¶n</button>
  <button onclick="setLevel('yellow')">ðŸŸ¡ Gul</button>
  <button onclick="setLevel('red')">ðŸ”´ RÃ¶d</button>
</div>

<div id="task">â€”</div>

<input id="answer" placeholder="Skriv ditt svar">
<button onclick="checkAnswer()">Kontrollera</button>
<button onclick="newTask()">Ny uppgift</button>

<p id="feedback"></p>

<script>
let currentLevel = "blue";
let correctAnswer = 0;

function r(a,b){return Math.floor(Math.random()*(b-a+1))+a;}

function genBlue(){
  let a=r(1,15), b=r(1,12), c=r(1,12);
  return `${a} + ${b} Â· ${c}`;
}

function genGreen(){
  let a=r(2,12), b=r(2,12);
  if(Math.random()<0.5){
    let c=r(1,b-1);
    return `${a} Â· (${b} - ${c})`;
  } else {
    let c=r(1,12);
    return `${a} Â· (${b} + ${c})`;
  }
}

function genYellow(){
  let a=r(2,12), b=r(2,12);
  let c=r(2,12), d=r(1,c-1);
  return `(${a}+${b}) Â· (${c}-${d})`;
}

function genRed(){
  let a=r(2,12), b=r(2,12);
  let divisor=r(2,12);
  let numerator=divisor*r(1,12);
  let frac=`\\frac{${numerator}}{${divisor}}`;
  return `${a} + ${b} Â· ${frac}`;
}

function generateExpression(level){
  if(level==="blue") return genBlue();
  if(level==="green") return genGreen();
  if(level==="yellow") return genYellow();
  return genRed();
}

function evaluateExpr(expr){
  let jsExpr = expr
    .replace(/\\frac{(\d+)}{(\d+)}/g,"($1/$2)")
    .replace(/Â·/g,"*");
  return Function('"use strict";return('+jsExpr+')')();
}

function newTask(){
  let expr = generateExpression(currentLevel);
  correctAnswer = evaluateExpr(expr);
  document.getElementById("task").innerHTML="\\("+expr+"\\)";
  if(window.MathJax) MathJax.typeset();
  document.getElementById("feedback").innerText="";
  document.getElementById("answer").value="";
}

function checkAnswer(){
  let ans = Number(document.getElementById("answer").value);
  document.getElementById("feedback").innerText =
    (Math.abs(ans-correctAnswer)<1e-9 ? "RÃ¤tt! ðŸŽ‰" : "Fel â€“ fÃ¶rsÃ¶k igen!");
}

function setLevel(level){ currentLevel=level; newTask(); }

newTask();
</script>

</body>
</html>