<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8">
  <title>Prioriteringsregler â€“ MatteÃ¶vning</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- MathJax fÃ¶r snygg brÃ¥knotation (mÃ¥ste vara en riktig <script>-tagg) -->
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/.js</script>

  <style>
    body { font-family: Arial, system-ui, Segoe UI, Roboto, Helvetica, sans-serif; max-width: 650px; margin: auto; padding: 20px; }
    h1 { margin-bottom: 10px; }
    #task { font-size: 30px; margin: 20px 0; min-height: 40px; }
    .levels button { padding: 6px 12px; margin: 4px; font-size: 16px; }
    #answer { font-size: 18px; padding: 6px; width: 140px; }
    #feedback { font-size: 18px; font-weight: bold; margin-top: 10px; min-height: 28px; }
  </style>
</head>
<body>

<h1>TrÃ¤na pÃ¥ prioriteringsregler</h1>

<div class="levels">
  <button onclick="setLevel('blue')">ðŸ”µ BlÃ¥</button>
  <button onclick="setLevel('green')">ðŸŸ¢ GrÃ¶n</button>
  <button onclick="setLevel('yellow')">ðŸŸ¡ Gul</button>
  <button onclick="setLevel('red')">ðŸ”´ RÃ¶d</button>
</div>

<div id="task">â€”</div>

<input id="answer" placeholder="Skriv ditt svar">
<button onclick="checkAnswer()">Kontrollera</button>
<button onclick="newTask()">Ny uppgift</button>

<p id="feedback"></p>

<!-- VIKTIGT: Allt JavaScript ligger i en (1) korrekt avslutad <script>-tagg -->
<script>
// =========================================================
// Globalt
// =========================================================
let currentLevel = "blue";
let correctAnswer = 0;

// Slumptal
function r(min, max) { return Math.floor(Math.random() * (max - min + 1)) + min; }

// =========================================================
// Generatorer â€“ rena uttryck, heltal, inga negativa, Â· fÃ¶r multiplikation
// =========================================================

// ðŸ”µ BlÃ¥: a + b Â· c
function genBlue() {
  const a = r(1, 15), b = r(1, 12), c = r(1, 12);
  return `${a} + ${b} Â· ${c}`;
}

// ðŸŸ¢ GrÃ¶n: a Â· (b Â± c) dÃ¤r (b > c) vid minus
function genGreen() {
  const a = r(2, 12), b = r(2, 12);
  const minus = Math.random() < 0.5;
  if (minus) {
    const c = r(1, b - 1);             // b - c > 0
    return `${a} Â· (${b} - ${c})`;
  } else {
    const c = r(1, 12);
    return `${a} Â· (${b} + ${c})`;
  }
}

// ðŸŸ¡ Gul: (a + b) Â· (c - d) med c > d
function genYellow() {
  const a = r(2, 12), b = r(2, 12);
  const c = r(2, 12), d = r(1, c - 1);
  return `(${a} + ${b}) Â· (${c} - ${d})`;
}

// ðŸ”´ RÃ¶d: a + b Â· \frac{numerator}{divisor} (heltalsdivision, alltid brÃ¥k)
function genRed() {
  const a = r(2, 12);
  const b = r(2, 12);
  const divisor = r(2, 12);
  const numerator = divisor * r(1, 12);        // garanterar heltal vid division
  const frac = `\\frac{${numerator}}{${divisor}}`;
  return `${a} + ${b} Â· ${frac}`;
}

// HuvudvÃ¤ljare
function generateExpression(level) {
  if (level === "blue") return genBlue();
  if (level === "green") return genGreen();
  if (level === "yellow") return genYellow();
  if (level === "red") return genRed();
  return genBlue();
}

// =========================================================
// UtvÃ¤rdering â€“ gÃ¶r om \frac{a}{b} till (a/b) och Â· till *
// =========================================================
function evaluateMathExpr(expr) {
  const jsExpr = expr
    .replace(/\\frac{(\d+)}{(\d+)}/g, "($1/$2)")
    .replace(/Â·/g, "*");
  // SÃ¤ker kÃ¶rning av bara siffror/operatÃ¶rer vi skapat
  return Function('"use strict"; return (' + jsExpr + ')')();
}

// =========================================================
// Rendering och interaktion
// =========================================================
function newTask() {
  const expr = generateExpression(currentLevel);
  correctAnswer = evaluateMathExpr(expr);
  // Visa uttrycket via MathJax
  const el = document.getElementById("task");
  el.innerHTML = "\\(" + expr + "\\)";
  // Trigga omrendering av MathJax
  if (window.MathJax && MathJax.typeset) MathJax.typeset();
  document.getElementById("feedback").innerText = "";
  document.getElementById("answer").value = "";
}

function checkAnswer() {
  const ans = Number(document.getElementById("answer").value);
  const ok = (Math.abs(ans - correctAnswer) < 1e-9); // tolerans mot t.ex. 12 vs 12.0
  document.getElementById("feedback").innerText = ok ? "RÃ¤tt! ðŸŽ‰" : "Inte riktigt â€“ fÃ¶rsÃ¶k igen!";
}

function setLevel(level) {
  currentLevel = level;
  newTask();
}

// FÃ¶rsta uppgiften
newTask();
</script>

</body>
</html>
